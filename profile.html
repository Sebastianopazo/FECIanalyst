<!DOCTYPE html>
<html>

<head>
    <title>Profile</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/ionicons.min.css">
    <link rel="stylesheet" href="assets/css/animsition.min.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<!--body-->

<body class="animsition">
    <header class="main-header">
        <div class="container">
            <a href="index.html">
                <div id="logo">
                </div>
            </a>
            <div class="menu">
                <!-- desktop navbar -->
                <nav class="desktop-nav">
                    <ul class="first-level">
                        <li><a href="dashboard.html" class="animsition-link">Home</a></li>
                        <li><a href="about.html" class="animsition-link">about FECI</a></li>
                        <li><a href="faqs.html" class="animsition-link">FAQs</a></li>
                        <li><a href="techSupport.html" class="animsition-link">Tech Support</a></li>
                        <li>
                            <a id="loginLi" href="#">Login</a>
                        </li>
                        <div class="bubble" id="loginBubble" data-tooltip="0">
                            <form id='loginForm' action="#" method="post">
                                <div class="input_4">
                                    <input id=txtEmail type="text" name="user name" autocomplete="off" placeholder="User Name">
                                </div>
                                <div class="input_4">
                                    <input id=txtPassword name="password" type="password" placeholder="Password">
                                </div>
                                <a id="btnLogin" href="#" class="btn white2"><span>Login</span></a>
                                <p>
                                  Forgot password?
                                </p>
                                <div class="arrow"></div>
                        </div>
                        <li><a id="logoutLi" href="#">Profile</a></li>
                        <div class="bubble2" id="logoutBubble" data-tooltip="0">
                            <div class="arrow2"></div>
                            <div class="name"></div>
                            <div class="lastName"></div>
                            <a href="#" class="editProfile">
                                <img id="profileImage" src="" alt="" />
                                <span>Edit Profile</span>
                            </a>
                            <a id="btnLogout" href="#" class="btn white2"><span>Logout</span></a>
                        </div>
                    </ul>
                </nav>
                <!-- mobile navbar -->
                <nav class="mobile-nav"></nav>
                <div class="menu-icon">
                    <div class="line"></div>
                    <div class="line"></div>
                    <div class="line"></div>
                </div>
            </div>
        </div>
    </header>
    <div class="site-hero_2">
        <div class="col-md-12">
        </div>
        <a href="index.html">
        </a>
        <div class="page-title">
            <div class="big-title montserrat-text uppercase">
                <div id="titleName">
                </div>
                <div id="titleLastName">
                </div>
            </div>
            <div class="small-title montserrat-text uppercase">HOME/Profile</div>
        </div>
    </div>
    <section>
        <div class="section-title">
            <span>User Profile</span>
        </div>
        <div class="container">
            <div class="row">
                <div id="successImage" class="alert alert-success">
                    <strong>Success! </strong>Image Updated!
                </div>
                <div id="successInfo" class="alert alert-success">
                    <strong>Success! </strong>Information Updated!
                </div>
            </div>
            <div class="row">
                <div class="col-md-9">
                    <div class="row">
                        <div class="white-section">
                            <div class="row">
                                <form action="#" method="post">
                                    <div class="col-md-6">
                                        <div class="input_1" style="margin-bottom:30px">
                                            <input id="name" value="" type="text" name="Name" autocomplete="off" readonly="readonly">
                                            <span class="active">Name</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input_1" style="margin-bottom:30px">
                                            <input id="lastName" value="" type="text" name="Last Name" autocomplete="off" readonly="readonly">
                                            <span class="active">Last Name</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input_1" style="margin-bottom:30px">
                                            <input id="secondLastName" value="" type="text" name="second Last Name" autocomplete="off" readonly="readonly">
                                            <span class="active">Second Last Name</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input_1" style="margin-bottom:30px">
                                            <input id="email" value="sropazo@uc.cl" type="text" name="Email" autocomplete="off" readonly="readonly">
                                            <span class="active">Email</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input_1" style="margin-bottom:30px">
                                            <input id="supervisor" value="VerÃ³nica Bagladi" type="text" name="supervisor" autocomplete="off" readonly="readonly">
                                            <span class="active">Supervisor</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="input_1" style="margin-bottom:30px">
                                            <input id="program" value="Masters 2015" type="text" name="program" autocomplete="off" readonly="readonly">
                                            <span class="active">Program</span>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <a id="editInfo" class="btn green2"><span><div class="edit2"></div>Edit Information</span></a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <a class="tooltips_item4 wow fadeInUp">
                        <div>
                            <h3>PROFILE IMAGE</h3>
                            <img id="profileImage2" src="" alt="" />
                        </div>
                        <div class="tooltips_item_hover">
                            <div class="item_info">
                                <span>Edit Profile Image</span>
                                <em id="editPicture"><div class="edit2"></div>EDIT</em>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </section>
    <!-- Login Info -->
    <section id="loginInfo" class="green-section wow fadeInUp" style="padding:50px 0">
        <div class="container">
            <div class="col-md-6 col-sm-12">
                <div class="row">
                    <div class="green-section" style="padding:20px">
                        <span class="white-text montserrat-text uppercase" style="font-size:24px;display:block;">
                						Returning User?
                        </span>
                        <p class="white-text">
                            Login Here!
                        </p>
                        <div class="row">
                            <form action="#" method="post">
                                <div class="col-md-10 spaceup">
                                    <div class="input_3" style="margin-bottom:30px">
                                        <input id=txtEmail type="text" name="name" autocomplete="off">
                                        <span>Email</span>
                                    </div>
                                </div>
                                <div class="col-md-10">
                                    <div class="input_3" style="margin-bottom:30px">
                                        <input id=txtPassword type="password" name="name" autocomplete="off">
                                        <span>Password</span>
                                    </div>
                                </div>
                        </div>
                        <a href="#" id="btnLogin" class="btn white" style="margin-top:30px"><span>Login</span></a>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-sm-12">
                <div class="row">
                    <div class="white-section" style="padding:20px">
                        <span class="montserrat-text uppercase" style="font-size:24px">Create a New User</span>
                        <p>
                            Create Your Account with the Code that your Instructor Gave you.
                        </p>
                        <div class="row">
                            <form action="#" method="post">
                                <div class="col-md-6">
                                    <div class="input_1" style="margin-bottom:30px">
                                        <input type="text" name="Email" autocomplete="off">
                                        <span>Email</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input_1" style="margin-bottom:30px">
                                        <input type="text" name="Name" autocomplete="off">
                                        <span>Name</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input_1" style="margin-bottom:30px">
                                        <input type="text" name="Last Name" autocomplete="off">
                                        <span>Last Name</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input_1" style="margin-bottom:30px">
                                        <input type="text" name="email" autocomplete="off">
                                        <span>Supervisor</span>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="input_1" style="margin-bottom:30px">
                                        <input type="text" name="code" autocomplete="off">
                                        <span>Code</span>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <a href="#" class="btn green"><span>Sign Up	</span></a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- FOOTER -->
    <footer class="main-footer wow fadeInUp">
        <div class="container">
            <div class="col-md-8 col-sm-12">
                <div class="row">
                    <nav class="footer-nav">
                        <ul>
                            <li><a href="index.html" class="animsition-link link">Home</a></li>
                            <li><a href="about.html" class="animsition-link link">about FECI</a></li>
                            <li><a href="faqs.html" class="animsition-link link">FAQs</a></li>
                            <li><a href="techSupport.html" class="animsition-link link">Tech Support</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="col-md-4 col-sm-12" style="text-align:right">
                <div class="row">
                    <div class="uppercase gray-text">
                        created by Sebastian Opazo.
                    </div>
                    <ul class="social-icons" style="margin-top:30px;float:right">
                        <li><a href="#"><i class="icon ion-social-facebook"></i></a></li>
                        <li><a href="#"><i class="icon ion-social-twitter"></i></a></li>
                        <li><a href="#"><i class="icon ion-social-youtube"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!--hidden lightbox form for adding profile information-->
    <div id="light" class="white_content wow fadeInUp">
        <h2 class="small-title montserrat-text uppercase">
			Edit Profile Information:
		<h2>
        <div class="row">
                    <form id="userInfo" action="#" method="post">
                        <div class="col-md-12">
                            <div class="input_1" style="margin-bottom:30px">
                                <input id="name2" value="" type="text" name="Name" autocomplete="off">
                                <span class="active">Name</span>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="input_1" style="margin-bottom:30px">
                                <input id="lastName2" value="" type="text" name="Last Name" autocomplete="off">
                                <span class="active">Last Name</span>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="input_1" style="margin-bottom:30px">
                                <input id="secondLastName2" value="" type="text" name="second Last Name" autocomplete="off">
                                <span class="active">Second Last Name</span>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="input_1" style="margin-bottom:30px">
                                <input id="email2" value="" type="text" name="Email" autocomplete="off" >
                                <span class="active">Email</span>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="input_1" style="margin-bottom:30px">
                                <input id="supevisor2" value="" type="text" name="supervisor" autocomplete="off" >
                                <span class="active">Supervisor</span>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <h4 id="selectTitle">Program</h4>
                            <select name="program">
                              <option value="Masters 2015">Select</option>
                              <option value="Masters 2015">Masters 2015</option>
                              <option value="Masters 2016">Masters 2016</option>
                              <option value="Masters 2017">Masters 2017</option>
                              <option value="Internship">Internship</option>
                              <option value="Certificate 2015">Certificate 2015</option>
                              <option value="Certificate 2016">Certificate 2016</option>
                              <option value="Certificate 2017">Certificate 2017</option>
                              <option value="Supervisor">Supervisor</option>
                            </select>
                        </div>
                        <div class="col-md-12">
                            	<a id="submitInfo" class="btn green2">Save</a>
                              <a href="javascript:void(0)" onclick="$('#light').fadeOut('fast');$('#fade').fadeOut('fast')" class="btn green2">Cancel</a>
                        </div>
                    </form>

        </div>
	</div>
	<div id="fade" class="black_overlay"></div>
  <!--hidden lightbox to add profile pic-->
        <div id="light5" class="white_content wow fadeInUp">
          <div class="centerLightbox">
            <div class="col-md-6">
              <h2 class="small-title montserrat-text uppercase">
                  Edit Profile Picture:
              <h2>
              <img id="profileImage3" src="" alt="" />
              <h4>Upload New Image</h4>
              <input id="uploadImage" type="file" accept="image/*">
              <progress id="loader" value="0" max="100">0%</progress>
              <a href="javascript:void(0)" onclick="document.getElementById('light5').style.display='none';document.getElementById('fade5').style.display='none'" class="btn green2">Cancel</a>
            </div>
      </div>
  </div>
  <div id="fade5" class="black_overlay"></div>

	<!-- SCRIPTS -->
	<script src="https://www.gstatic.com/firebasejs/3.5.3/firebase.js"></script>
	<script type="text/javascript" src="assets/js/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="assets/js/jquery.animsition.min.js"></script>
	<script type="text/javascript" src="assets/js/wow.min.js"></script>
	<script type="text/javascript" src="assets/js/main.js"></script>
	<script type="text/javascript" src="assets/js/fecianalyst.js"></script>
	<script type="text/javascript">
		$(window).load(function() {
			new WOW().init();
		});
	</script>
  <script type="text/javascript">

    //get profile information from firebase
    firebase.auth().onAuthStateChanged(firebaseUser =>{
    	if (firebaseUser) {
    		//get current user UID
    		var currentUserUID = firebaseUser.uid;
    		const dbrefUserInfo = firebase.database().ref('users').child(currentUserUID);
          dbrefUserInfo.on('value', function(userSnapshot) {
          var info = userSnapshot.val();
          var userInfo = Object.values(info);
          $("#name").val(userInfo[2]);
          $("#lastName").val(userInfo[1]);
          $("#secondLastName").val(userInfo[5]);
          $("#email").val(userInfo[0]);
          $("#supevisor").val(userInfo[6]);
          $("#program").val(userInfo[4]);
          $("#name2").val(userInfo[2]);
          $("#lastName2").val(userInfo[1]);
          $("#secondLastName2").val(userInfo[5]);
          $("#email2").val(userInfo[0]);
          $("#supevisor2").val(userInfo[6]);
        }, function(error) {
            console.log(error);
        });
      }
      })
    //edit personal info with lightbox
    $("#editInfo").click(function(){
      $('#light').fadeIn('fast');
      $('#fade').fadeIn('fast');
    });

    //submit new info to firebase
    firebase.auth().onAuthStateChanged(firebaseUser =>{
      if (firebaseUser) {
        $("#submitInfo").click(function(){
          var currentUserUID = firebaseUser.uid;
          var userFormArray = [];
          const postRefUser = firebase.database().ref('users').child(currentUserUID);
        $("#successInfo").fadeIn('fast').delay(2000).fadeOut("fast");
        $('#light').fadeOut('fast');
        $('#fade').fadeOut('fast');
        for (var i = 0; i < 6; i++) {
					var userInput = document.getElementById('userInfo').elements[i].value;
          userFormArray.push(userInput);
        }
        function userInfoArrayToObject (array) {
					var userInfoObject = {"email" : array[3], "lastName" : array[1], "name" : array[0], "program" : array[5], "secondLastName" : array[2], "supervisor" : array[4]}
					postRefUser.update(userInfoObject);
				}
        userInfoArrayToObject(userFormArray);
        })
      }
    })


    //upload profile image to firebase

    //edit profile image with lightbox
      $("#editPicture").click(function(){
        document.getElementById('light5').style.display='block';
        document.getElementById('fade5').style.display='block';
      });
      //get elements
      var loader = document.getElementById('loader')
      var uploadImage = document.getElementById('uploadImage');
        //listen for file selection
        uploadImage.addEventListener('change', function(e) {
        //get file
        var file = e.target.files[0];
        firebase.auth().onAuthStateChanged(firebaseUser => {
            if (firebaseUser) {
              var currentUserUID = firebaseUser.uid;
              //make reference
              var storageRef = firebase.storage().ref(currentUserUID + '/profilePic/' + file.name);
              //Upload File
              var task = storageRef.put(file);

              //Update progress
              task.on('state_changed',
                function progress(snapshot) {
                  var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                  loader.value = percentage;

                },
                function error(err){

                },
                function complete(){
                }
              );
              //update profile picture path on user
              function replaceProfileImage(imageUrl) {
                firebase.database().ref('users/' + currentUserUID).update({
                  profilePicture : imageUrl
                });
              }
              replaceProfileImage(currentUserUID + '/profilePic/' + file.name);
              $("#loader").fadeIn('fast').delay(1000).fadeOut("fast");
        }
        });
    });

  </script>
</body>

</html>
