<!DOCTYPE html>
<html>

<head>
	<title>Dashboard</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/css/ionicons.min.css">
	<link rel="stylesheet" href="assets/css/animsition.min.css">
	<link rel="stylesheet" href="assets/css/animate.css">
	<link rel="stylesheet" href="assets/css/style.css">
</head>
<!--body-->

<body class="animsition">
	<header class="main-header">
		<div class="container">
			<a href="index.html">
				<div id="logo">
				</div>
			</a>
			<div class="menu">
				<!-- desktop navbar -->
				<nav class="desktop-nav">
					<ul class="first-level">
						<li><a href="index.html" class="animsition-link">Home</a></li>
						<li><a href="about.html" class="animsition-link">about FECI</a></li>
						<li><a href="faqs.html" class="animsition-link">FAQs</a></li>
						<li><a href="techSupport.html" class="animsition-link">Tech Support</a></li>
						<li>
							<a id="loginLi" href="#">Login
							</a>
						</li>
						<div class="bubble" id="loginBubble" data-tooltip="0">
							<form id='loginForm' action="#" method="post">
								<div class="input_4">
									<input id=txtEmail type="text" name="user name" autocomplete="off" placeholder="User Name">
								</div>
								<div class="input_4">
									<input id=txtPassword name="password" type="password" placeholder="Password">
								</div>
								<a id="btnLogin" href="#" class="btn white2"><span>Login</span></a>
								<div class="arrow"></div>
						</div>
						<li><a id="logoutLi" href="#">Profile</a></li>
						<div class="bubble2" id="logoutBubble" data-tooltip="0">
							<div class="arrow2"></div>
							<div class="name"></div>
							<div class="lastName"></div>
							<a href="#" class="editProfile">
								<img id="profileImage" src="" alt=""/>
								<span>Edit Profile</span>
							</a>
							<a id="btnLogout" href="#" class="btn white2"><span>Logout</span></a>
						</div>
					</ul>
				</nav>
				<!-- mobile navbar -->
				<nav class="mobile-nav"></nav>
				<div class="menu-icon">
					<div class="line"></div>
					<div class="line"></div>
					<div class="line"></div>
				</div>
			</div>
		</div>
	</header>
	<div class="site-hero_2">
		<div class="col-md-12">
		</div>
		<a href="index.html">
		</a>
		<div class="page-title">
			<div class="big-title montserrat-text uppercase">
			</div>
			<div class="small-title montserrat-text uppercase">HOME/Dashboard</div>
		</div>
	</div>
	<section>
		<div class="section-title">
			<span>Your Patients</span>
		</div>
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<a href="javascript:void(0)" onclick="document.getElementById('light').style.display='block';document.getElementById('fade').style.display='block';" class="btn green"><span>Add Patient</span></a>
				</div>
			</div>
			<div class="row">
				<div id="successPatient" class="alert alert-success">
					<strong>Success! </strong>Patient created!
				</div>
				<div class="widget wow fadeInUp">
					<ul id="patientList" class="list">
				</div>
			</div>
		</div>
	</section>
	<!-- Login Info -->
	<section id="loginInfo" class="green-section wow fadeInUp" style="padding:50px 0">
		<div class="container">
			<div class="col-md-6 col-sm-12">
				<div class="row">
					<div class="green-section" style="padding:20px">
						<span class="white-text montserrat-text uppercase" style="font-size:24px;display:block;">
						Returning User?
					</span>
						<p class="white-text">
							Login Here!
						</p>
						<div class="row">
							<form action="#" method="post">
								<div class="col-md-10 spaceup">
									<div class="input_3" style="margin-bottom:30px">
										<input id=txtEmail type="text" name="name" autocomplete="off">
										<span>Email</span>
									</div>
								</div>
								<div class="col-md-10">
									<div class="input_3" style="margin-bottom:30px">
										<input id=txtPassword type="password" name="name" autocomplete="off">
										<span>Password</span>
									</div>
								</div>
						</div>
						<a href="#" id="btnLogin" class="btn white" style="margin-top:30px"><span>Login</span></a>
						</form>
					</div>
				</div>
			</div>
			<div class="col-md-6 col-sm-12">
				<div class="row">
					<div class="white-section" style="padding:20px">
						<span class="montserrat-text uppercase" style="font-size:24px">Create a New User</span>
						<p>
							Create Your Account with the Code that your Instructor Gave you.
						</p>
						<div class="row">
							<form action="#" method="post">
								<div class="col-md-6">
									<div class="input_1" style="margin-bottom:30px">
										<input id="txtEmail2" type="text" name="Email" autocomplete="off">
										<span>Email</span>
									</div>
								</div>
								<div class="col-md-6">
									<div class="input_1" style="margin-bottom:30px">
										<input type="text" name="Name" autocomplete="off">
										<span>Name</span>
									</div>
								</div>
								<div class="col-md-6">
									<div class="input_1" style="margin-bottom:30px">
										<input type="text" name="Last Name" autocomplete="off">
										<span>Last Name</span>
									</div>
								</div>
								<div class="col-md-6">
									<div class="input_1" style="margin-bottom:30px">
										<input type="text" name="email" autocomplete="off">
										<span>Supervisor</span>
									</div>
								</div>
								<div class="col-md-12">
									<div class="input_1" style="margin-bottom:30px">
										<input id="txtPass2" type="text" name="code" autocomplete="off">
										<span>Code</span>
									</div>
								</div>
								<div class="col-md-12">
									<a id="btnSignup" href="#" class="btn green"><span>Sign Up	</span></a>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- FOOTER -->
	<footer class="main-footer wow fadeInUp">
		<div class="container">
			<div class="col-md-8 col-sm-12">
				<div class="row">
					<nav class="footer-nav">
						<ul>
							<li><a href="index.html" class="animsition-link link">Home</a></li>
							<li><a href="about.html" class="animsition-link link">about FECI</a></li>
							<li><a href="faqs.html" class="animsition-link link">FAQs</a></li>
							<li><a href="techSupport.html" class="animsition-link link">Tech Support</a></li>
						</ul>
					</nav>
				</div>
			</div>
			<div class="col-md-4 col-sm-12" style="text-align:right">
				<div class="row">
					<div class="uppercase gray-text">
						created by Sebastian Opazo.
					</div>
					<ul class="social-icons" style="margin-top:30px;float:right">
						<li><a href="#"><i class="icon ion-social-facebook"></i></a></li>
						<li><a href="#"><i class="icon ion-social-twitter"></i></a></li>
						<li><a href="#"><i class="icon ion-social-youtube"></i></a></li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<!--hidden lightbox form for adding patients-->
	<div id="light" class="white_content wow fadeInUp">
		<h2 class="small-title montserrat-text uppercase">
			Add Patient Information:
		<h2>
			<form id="patientInfo" action="index.html" method="post">
				<div class="input_1" style="margin-bottom:30px">
					<input type="text" name="Name" autocomplete="off">
					<span>Name</span>
				</div>
				<div class="input_1" style="margin-bottom:30px">
					<input type="text" name="Last Name" autocomplete="off">
					<span>Last Name</span>
				</div>
				<div class="input_1" style="margin-bottom:30px">
					<input type="text" name="Second Last Name" autocomplete="off">
					<span>Second Last Name</span>
				</div>
				<div class="input_1" style="margin-bottom:30px">
					<input type="text" name="Age" autocomplete="off">
					<span>Age</span>
				</div>
				<div class="input_1" style="margin-bottom:30px">
					<input type="text" name="Record Number" autocomplete="off">
					<span>Record Number</span>
				</div>
				<div class="input_1" style="margin-bottom:30px">
					<input type="date" name="Intake date" autocomplete="off">
					<span class="active">Intake Date</span>
				</div>
			</form>

		<a id="submitPatientInfo" href="#" class="btn green2">Save Information</a>
		<a href="javascript:void(0)" onclick="document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'" class="btn green2">Close</a>
	</div>
	<div id="fade" class="black_overlay"></div>

	<!-- SCRIPTS -->
	<script src="https://www.gstatic.com/firebasejs/3.5.3/firebase.js"></script>
	<script type="text/javascript" src="assets/js/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="assets/js/jquery.animsition.min.js"></script>
	<script type="text/javascript" src="assets/js/wow.min.js"></script>
	<script type="text/javascript" src="assets/js/main.js"></script>
	<script type="text/javascript" src="assets/js/fecianalyst.js"></script>
	<script type="text/javascript">
		$(window).load(function() {
			new WOW().init();
		});
	</script>
	<script type="text/javascript">


//get current user patients list from database
firebase.auth().onAuthStateChanged(firebaseUser =>{
	if (firebaseUser) {
		//get current user UID
		var currentUserUID = firebaseUser.uid;
		const dbrefPatients = firebase.database().ref('allPatientList').child(currentUserUID).child('patientList');
		dbrefPatients.on('value', function(snapshot) {
			var patientList = snapshot.val();
			//loop to get all patients from database
			var i = 0;
			$("#patientList").empty();
			while (Object.keys(patientList)[i] != null) {
				//get a specific patient info
				var currentPatientId = Object.keys(patientList)[i];
				var patientToArray = Object.values(patientList[currentPatientId]);
					//append info to list
					//create function to filter and append name and lastnames from patients
					function addNamesToList (array) {
						$("#patientList").append("<li class='patient'><a href='#'>"+ array[3] + " " + array[2] + " " + array[5] +"<span><div class='info'></div><div class='edit'></div><div id='" + currentPatientId +"'class='delete'></div></span></a></li>");
					}

					addNamesToList(patientToArray);
					i++;
				}
 				}, function(error) {
						console.log(error);
		});
	}
});

//upload information from Patient Form on completion

	firebase.auth().onAuthStateChanged(firebaseUser =>{
		if (firebaseUser) {
			//get current user UID
			var currentUserUID = firebaseUser.uid;
			const postRefPatients = firebase.database().ref('allPatientList').child(currentUserUID).child('patientList');

			//turn inputs into array and the array into a "patient object"
			var patientFormArray = [];
			//when clicking on submit, submit info
			$("#submitPatientInfo").click(function(){
				for (var i = 0; i < 6; i++) {
					var patientInput = document.getElementById("patientInfo").elements[i].value;
						patientFormArray.push(patientInput)
						console.log(patientInput);
				}
				//function to turn the array rom the form into an object that can be sent to firebase; also to upload to database
				function patientInfoArrayToObject (array) {
					var patientInfoObject = {"age" : array[3], "intakeDate" : array[5], "lastName" : array[1], "name" : array[0], "recordNumber" : array[4], "secondLastName" : array[2]}
					postRefPatients.push().set(patientInfoObject);
				}
				patientInfoArrayToObject(patientFormArray);
				var lightBox1 = document.getElementById('light');
				var fade = document.getElementById('fade')
				lightBox1.style.display='none';
				fade.style.display='none';
				$("#successPatient").fadeIn('fast').delay(2000).fadeOut("fast");



		});
		//press "delete" bin to remove patient;
	};
});

</script>


</body>

</html>
