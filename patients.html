<!DOCTYPE html>
<html>

<head>
    <title>Patients</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/ionicons.min.css">
    <link rel="stylesheet" href="assets/css/animsition.min.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<!--body-->
<div id="overlay" class="overlay">
  <h1>Loading...</h1>
  <div class="loader"></div>
</div>
<body class="animsition">
    <header class="main-header">
        <div class="container">
            <a href="index.html">
                <div id="logo">
                </div>
            </a>
            <div class="menu">
                <!-- desktop navbar -->
                <nav class="desktop-nav">
                    <ul class="first-level">
                        <li><a href="dashboard.html" class="animsition-link">Home</a></li>
                        <li><a href="about.html" class="animsition-link">about FECI</a></li>
                        <li><a href="faqs.html" class="animsition-link">FAQs</a></li>
                        <li><a href="techSupport.html" class="animsition-link">Tech Support</a></li>
                        <li>
                            <a id="loginLi" href="#">Login
							</a>
                        </li>
                        <div class="bubble" id="loginBubble" data-tooltip="0">
                            <form id='loginForm' action="#" method="post">
                                <div class="input_4">
                                    <input id=txtEmail type="text" name="user name" autocomplete="off" placeholder="User Name">
                                </div>
                                <div class="input_4">
                                    <input id=txtPassword name="password" type="password" placeholder="Password">
                                </div>
                                <a id="btnLogin" href="#" class="btn white2"><span>Login</span></a>
                                <p>
                                  Forgot password?
                                </p>
                                <div class="arrow"></div>
                        </div>
                        <li><a id="logoutLi" href="#">Profile</a></li>
                        <div class="bubble2" id="logoutBubble" data-tooltip="0">
                            <div class="arrow2"></div>
                            <div class="name"></div>
                            <div class="lastName"></div>
                            <a href="profile.html" class="editProfile">
                                <img id="profileImage" src="" alt="" />
                                <span>Edit Profile</span>
                            </a>
                            <a id="btnLogout" href="#" class="btn white2"><span>Logout</span></a>
                        </div>
                    </ul>
                </nav>
                <!-- mobile navbar -->
                <nav class="mobile-nav"></nav>
                <div class="menu-icon">
                    <div class="line"></div>
                    <div class="line"></div>
                    <div class="line"></div>
                </div>
            </div>
        </div>
    </header>
    <div class="site-hero_2">
        <div class="col-md-12">
        </div>
        <a href="index.html">
        </a>
        <div class="page-title">
            <div class="big-title montserrat-text uppercase">
              <div id="titleName">
              </div>
              <div id="titleLastName">
              </div>
            </div>
            <div class="small-title montserrat-text uppercase">HOME/Dashboard</div>
        </div>
    </div>
    <section>
        <div class="section-title">
            <span>Your Patients</span>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-10">
                    <a id="addPatient" class="btn green2"><span>Add Patient</span></a>
                    <a href="dashboard.html" class="btn green2"><span>Back to Dashboard</span></a>
                </div>
                <div class="col-md-2">
                    <h5>Actions</h5>
                </div>
            </div>
            <div class="row">
                <div id="successPatient" class="alert alert-success">
                    <strong>Success! </strong>Patient created!
                </div>
                <div id="noPatients" class="alert alert-info">
                    <strong>You don't have any patients</strong>
                </div>
                <div class="col-md-12">
                  <ul id="patientList" class="list_6"></ul>
                </div>
            </div>
        </div>
    </section>
  </form>
    <!-- signup Info -->
    <section id="signupInfo" class="green-section wow fadeInUp" style="padding:50px 0">
        <div class="container">
            <div class="col-md-12">
                <div class="row">
                    <div class="white-section" style="padding:20px">
                        <span class="montserrat-text uppercase" style="font-size:24px">Create a New User</span>
                        <p>
                            Create Your Account with the Code that your Instructor Gave you.
                        </p>
                        <div class="row">
                            <form action="#" method="post">
                                <div class="col-md-6">
                                    <div class="input_1" style="margin-bottom:30px">
                                        <input id="signupEmail" type="text" name="Email" autocomplete="off">
                                        <span>Email</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input_1" style="margin-bottom:30px">
                                        <input id="signupName" type="text" name="Name" autocomplete="off">
                                        <span>Name</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input_1" style="margin-bottom:30px">
                                        <input id="signupLastName" type="text" name="Last Name" autocomplete="off">
                                        <span>Last Name</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input_1" style="margin-bottom:30px">
                                        <input id="signupSecondLastName" type="text" name="Second Last Name" autocomplete="off">
                                        <span>Second Last Name</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input_1" style="margin-bottom:15px">
                                        <input id="signupSupervisor" type="text" name="email" autocomplete="off">
                                        <span>Supervisor</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input_1" style="margin-bottom:15px">
                                        <input id="signupCode" type="text" name="code" autocomplete="off">
                                        <span>Security Code</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input_3" style="margin-bottom:15px">
                                        <input id="signupPassword" type="password" name="password" autocomplete="off">
                                        <span>Password</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="input_3" style="margin-bottom:15px">
                                        <input id="signupPassword2" type="password" name="password2" autocomplete="off">
                                        <span>Repeat Password</span>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <h4 class="selectTitle">Program</h4>
                                    <select id="signupProgram" name="program">
                                      <option value="Masters 2015">Select</option>
                                      <option value="Masters 2015">Masters 2015</option>
                                      <option value="Masters 2016">Masters 2016</option>
                                      <option value="Masters 2017">Masters 2017</option>
                                      <option value="Internship">Internship</option>
                                      <option value="Certificate 2015">Certificate 2015</option>
                                      <option value="Certificate 2016">Certificate 2016</option>
                                      <option value="Certificate 2017">Certificate 2017</option>
                                      <option value="Supervisor">Supervisor</option>
                                    </select>
                                </div>
                                <div class="col-md-12">
                                    <a id="btnSignUp" href="#" class="btn green"><span>Sign Up	</span></a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- FOOTER -->
    <footer class="main-footer wow fadeInUp">
        <div class="container">
            <div class="col-md-8 col-sm-12">
                <div class="row">
                    <nav class="footer-nav">
                        <ul>
                            <li><a href="dashboard.html" class="animsition-link link">Home</a></li>
                            <li><a href="about.html" class="animsition-link link">about FECI</a></li>
                            <li><a href="faqs.html" class="animsition-link link">FAQs</a></li>
                            <li><a href="techSupport.html" class="animsition-link link">Tech Support</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="col-md-4 col-sm-12" style="text-align:right">
                <div class="row">
                    <div class="uppercase gray-text">
                        created by Sebastian Opazo.
                    </div>
                    <ul class="social-icons" style="margin-top:30px;float:right">
                        <li><a href="#"><i class="icon ion-social-facebook"></i></a></li>
                        <li><a href="#"><i class="icon ion-social-twitter"></i></a></li>
                        <li><a href="#"><i class="icon ion-social-youtube"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!--hidden lightbox form for adding patients-->
    <div id="light" class="white_content">
        <h2 class="small-title montserrat-text uppercase">
			Add Patient Information:
		<h2>
			<form id="patientInfo" action="index.html" method="post">
				<div class="input_1" style="margin-bottom:30px">
					<input type="text" name="Name" autocomplete="off">
					<span>Name</span>
				</div>
				<div class="input_1" style="margin-bottom:30px">
					<input type="text" name="Last Name" autocomplete="off">
					<span>Last Name</span>
				</div>
				<div class="input_1" style="margin-bottom:30px">
					<input type="text" name="Second Last Name" autocomplete="off">
					<span>Second Last Name</span>
				</div>
				<div class="input_1" style="margin-bottom:30px">
					<input type="text" name="Age" autocomplete="off">
					<span>Age</span>
				</div>
				<div class="input_1" style="margin-bottom:30px">
					<input type="text" name="Record Number" autocomplete="off">
					<span>Record Number</span>
				</div>
				<div class="input_1" style="margin-bottom:30px">
					<input type="date" name="Intake date" autocomplete="off">
					<span class="active">Intake Date</span>
				</div>
			</form>

		<a id="submitPatientInfo" class="btn green2">Save Information</a>
		<a href="javascript:void(0)" onclick="$('#light').fadeOut('fast');$('#fade').fadeOut('fast')" class="btn green2">Close</a>
	</div>
	<div id="fade" class="black_overlay"></div>

	<!-- SCRIPTS -->
	<script src="https://www.gstatic.com/firebasejs/3.5.3/firebase.js"></script>
	<script type="text/javascript" src="assets/js/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="assets/js/jquery.animsition.min.js"></script>
	<script type="text/javascript" src="assets/js/wow.min.js"></script>
	<script type="text/javascript" src="assets/js/main.js"></script>
	<script type="text/javascript" src="assets/js/fecianalyst.js"></script>
	<script type="text/javascript">
		$(window).load(function() {
			new WOW().init();
		});
	</script>
	<script type="text/javascript">
	//create function to filter and append name and lastnames from patients
  function addNamesToList (array, id) {
    $("#patientList").append("<li class='patient'>"+ array[3] + " " + array[2] + " " + array[5] + "<span><a href='patient.html?" + id + ".html' class='bubble3 patientPage'><img src='images/edit.png'><span class='tooltiptext'>Edit Patient</span></a><span></li>");
  }
//GET PATIENTS INFO============================================================

//get current user patients list from database
firebase.auth().onAuthStateChanged(firebaseUser =>{
	if (firebaseUser) {
		//get current user UID
		var currentUserUID = firebaseUser.uid;
		const dbrefPatients = firebase.database().ref('allPatientList').child(currentUserUID).child('patientList');
		dbrefPatients.on('value', function(snapshot) {
			var patientList = snapshot.val();
      //if you have no patients, show a message;
			$("#patientList").empty();
      if (patientList === null) {
        $('#noPatients').show();
      } else{
        $('#noPatients').hide();
      //loop to get all patients from database
      var i = 0;
			while (Object.keys(patientList)[i] != null) {
				//get a specific patient info
				var currentPatientId = Object.keys(patientList)[i];
				var patientToArray = Object.values(patientList[currentPatientId]);
					//append info to list
					addNamesToList(patientToArray, currentPatientId);
					i++;
				}}
 				}, function(error) {
						console.log(error);
		});

//ADD PATIENTS =============================================================
//add patient button
$("#addPatient").click(function() {
  $('#light').fadeIn('fast');
  $('#fade').fadeIn('fast');
  $('#patientInfo')[0].reset();
});
//upload information from Patient Form on completion
			//turn inputs into array and the array into a "patient object"
			var patientFormArray = [];
			//when clicking on submit, submit info
			$("#submitPatientInfo").click(function(){
				for (var i = 0; i < 6; i++) {
					var patientInput = document.getElementById("patientInfo").elements[i].value;
						patientFormArray.push(patientInput);
				}
				//function to turn the array rom the form into an object that can be sent to firebase; also to upload to database
				function patientInfoArrayToObject (array) {
					var patientInfoObject = {"age" : array[3], "intakeDate" : array[5], "lastName" : array[1], "name" : array[0], "recordNumber" : array[4], "secondLastName" : array[2]};
					var newPatientKey = firebase.database().ref('allPatientList').child(currentUserUID).child('patientList').push().key;
           // Write the new Patient's ID simultaneously in the Patient list and the Measures list.
          var updates = {};
          updates['/patientsMeasures/' + newPatientKey] = "empty";
          updates['/allPatientList/' + currentUserUID + '/patientList/' + newPatientKey] = patientInfoObject;
          return firebase.database().ref().update(updates);
				}
				patientInfoArrayToObject(patientFormArray);
				var lightBox1 = document.getElementById('light');
				var fade = document.getElementById('fade');
				lightBox1.style.display='none';
				fade.style.display='none';
				$("#successPatient").fadeIn('fast').delay(2000).fadeOut("fast");

		});

    } else {
      window.location = 'index.html';
    }

    });



</script>


</body>

</html>
